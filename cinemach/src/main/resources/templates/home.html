<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>CineMatch</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
          background-color: #111;
          color: white;
          margin: 0;
          font-family: Arial, sans-serif;
        }

        header {
          background-color: #000;
          padding: 15px;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        header h1 {
          color: #c700ff;
          margin: 0;
        }

        nav a {
          color: white;
          margin-left: 15px;
          text-decoration: none;
          font-size: 18px;
        }

        main {
          padding: 20px;
        }

        h2 {
          text-align: center;
          color: #c700ff;
        }

        /* CATÁLOGO */
        .catalogo {
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          gap: 25px;
          margin-top: 20px;
        }

        /* CARD */
        .card {
          background: #1a1a1a;
          padding: 15px;
          border-radius: 12px;
          box-shadow: 0 4px 8px rgba(0,0,0,0.6);
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          align-items: center;
          text-align: center;
          transition: transform 0.3s ease, box-shadow 0.3s ease;
          width: 380px;   /* largura maior */
          height: 580px;  /* altura fixa */
        }

        .card:hover {
          transform: translateY(-8px) scale(1.03);
          box-shadow: 0 8px 20px rgba(214, 51, 255, 0.6);
        }

        .card img {
          width: 100%;
          height: 300px;
          object-fit: contain;  /* mostra a imagem inteira */
          background: #000;     /* fundo preto atrás da imagem */
          border-radius: 8px;
        }

        .card h3 {
          margin: 10px 0 5px;
          font-size: 18px;
          color: #c700ff;
        }

        .card p {
          margin: 4px 0;
        }

        /* DESCRIÇÃO LIMITADA */
        .descricao {
          font-size: 14px;
          color: #ccc;
          margin: 8px 0;
          overflow: hidden;
          text-overflow: ellipsis;
          display: -webkit-box;
          -webkit-line-clamp: 4;
          -webkit-box-orient: vertical;
          word-wrap: break-word;
        }
        .btn-mais {
            display: inline-block;
            padding: 10px 20px;
            background-color: #ff9800;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            transition: background 0.3s ease;
        }

        .btn-mais:hover {
            background-color: #e68900;
        }
        .nota {
          font-size: 14px;
          font-weight: bold;
          color: #ffcc00;
          margin: 8px 0;
        }

        .nota i {
          margin-right: 5px;
        }

        /* BOTÕES */
        .botoes {
          display: flex;
          justify-content: center;
          gap: 12px;
          margin-top: auto;
        }
        .paginacao {
    text-align: center;
    margin-top: 20px;
}

.btn-mais {
    display: inline-block;
    padding: 10px 20px;
    background-color: #ff9800;
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-weight: bold;
    transition: background 0.3s ease;
}

.btn-mais:hover {
    background-color: #e68900;
}

        .btn-like, .btn-dislike {
          padding: 8px 14px;
          border: none;
          border-radius: 6px;
          cursor: pointer;
          font-size: 14px;
          display: flex;
          align-items: center;
          gap: 6px;
          transition: transform 0.2s ease, background 0.3s ease;
          font-weight: bold;
        }
.paginacao {
  text-align: center;
  margin: 30px 0;
}

.btn-mais {
  padding: 12px 24px;
  background: #ff9800;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  font-size: 16px;
  cursor: pointer;
  transition: background 0.3s;
}

.btn-mais:hover {
  background: #e68900;
}
        .btn-like {
          background: linear-gradient(135deg, #28a745, #34d058);
          color: white;
        }

        .btn-like:hover {
          transform: scale(1.1);
          background: #218838;
        }

        .btn-dislike {
          background: linear-gradient(135deg, #dc3545, #ff4d6d);
          color: white;
        }

        .btn-dislike:hover {
          transform: scale(1.1);
          background: #c82333;
        }
    </style>
</head>
<body>
<header>
    <h1>CineMatch</h1>
    <nav>
        <a href="/"><i class="fa-solid fa-house"></i></a>
        <a href="/pesquisa"><i class="fa-solid fa-magnifying-glass"></i></a>
        <a href="/chat"><i class="fa-solid fa-comment"></i></a>
        <a href="/favoritos"><i class="fa-solid fa-heart"></i></a>
        <a href="/perfil"><i class="fa-solid fa-user"></i></a>
    </nav>
</header>

<main>
    <h2>Descubra filmes incríveis e pessoas com gostos semelhantes</h2>

    <section class="catalogo" id="catalogo">
        <div th:each="filme : ${filmes}" class="card">
            <img th:src="${filme.imagem}" alt="Poster do filme">
            <h3 th:text="${filme.titulo}"></h3>
            <p th:text="${filme.genero}"></p>
            <p class="descricao" th:text="${filme.descricao}"></p>
            <div class="nota"><i class="fa-solid fa-star"></i> <span th:text="${filme.nota}"></span></div>
            <div class="botoes">
                <button class="btn-like"><i class="fa-solid fa-thumbs-up"></i> Curtir</button>
                <button class="btn-dislike"><i class="fa-solid fa-thumbs-down"></i> Não curtir</button>
            </div>
        </div>
    </section>

    <div class="paginacao">
        <button id="btn-mais" class="btn-mais">Carregar mais</button>
    </div>

</main>
<script>
    let offset = 16;
const limit = 16;

document.getElementById("btn-mais").addEventListener("click", () => {
    const btnMais = document.getElementById("btn-mais");
    const skeletons = document.getElementById("skeletons");

    // mostra skeletons
    skeletons.innerHTML = "";
    for (let i = 0; i < limit; i++) {
        skeletons.innerHTML += `
            <div class="card skeleton">
                <div class="skeleton-img"></div>
                <div class="skeleton-text"></div>
                <div class="skeleton-text short"></div>
            </div>
        `;
    }
    skeletons.classList.remove("hidden");

    fetch(`/mais?offset=${offset}&limit=${limit}`)
        .then(res => res.json())
        .then(filmes => {
            const catalogo = document.getElementById("catalogo");

            filmes.forEach(filme => {
                const card = document.createElement("div");
                card.classList.add("card");
                card.innerHTML = `
                    <img src="${filme.imagem}" alt="Poster do filme">
                    <h3>${filme.titulo}</h3>
                    <p>${filme.genero}</p>
                    <p class="descricao">${filme.descricao}</p>
                    <div class="nota"><i class="fa-solid fa-star"></i> ${filme.nota}</div>
                    <div class="acoes">
                        <button class="curtir"><i class="fa-solid fa-thumbs-up"></i></button>
                        <button class="nao-curtir"><i class="fa-solid fa-thumbs-down"></i></button>
                    </div>
                `;
                catalogo.appendChild(card);
            });

            offset += filmes.length;

            if (filmes.length < limit) {
                btnMais.style.display = "none"; // só some quando não tiver mais
            }

            // esconde skeleton
            skeletons.classList.add("hidden");
        })
        .catch(() => {
            skeletons.classList.add("hidden");
        });
});
let offset = 16;
const limit = 16;

document.getElementById("btn-mais").addEventListener("click", () => {
    const btn = document.getElementById("btn-mais");
    btn.disabled = true;
    btn.textContent = "Carregando...";

    fetch(`/mais?offset=${offset}&limit=${limit}`)
        .then(res => res.json())
        .then(filmes => {
            const catalogo = document.getElementById("catalogo");

            filmes.forEach(filme => {
                const card = document.createElement("div");
                card.classList.add("card");
                card.innerHTML = `
                    <img src="${filme.imagem}" alt="Poster do filme">
                    <h3>${filme.titulo}</h3>
                    <p>${filme.genero}</p>
                    <p class="descricao">${filme.descricao}</p>
                    <div class="nota"><i class="fa-solid fa-star"></i> ${filme.nota}</div>
                    <div class="botoes">
                        <button class="btn-like"><i class="fa-solid fa-thumbs-up"></i> Curtir</button>
                        <button class="btn-dislike"><i class="fa-solid fa-thumbs-down"></i> Não curtir</button>
                    </div>
                `;
                catalogo.appendChild(card);
            });

            offset += filmes.length;

            if (filmes.length < limit) {
                btn.style.display = "none"; // só some quando não houver mais
            } else {
                btn.disabled = false;
                btn.textContent = "Carregar mais";
            }
        })
        .catch(() => {
            btn.disabled = false;
            btn.textContent = "Carregar mais";
        });
});
</script>
</body>
</html>
