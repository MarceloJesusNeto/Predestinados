<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>CineMatch</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" href="/img/cinematchlogo1-removebg-preview (1).png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/home.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
</head>
<body>
<header th:if="${session.usuarioLogado != null}">
    <div class="logo-header">
        <img src="/img/cinematchlogo1-removebg-preview.png" alt="CineMatch Logo">
        <h1>CineMatch</h1>
    </div>
    <nav class="nav-links">
        <a href="/">
            <i class="fa-solid fa-house"></i>
            <span>Home</span>
        </a>
        <a href="/pesquisa">
            <i class="fa-solid fa-magnifying-glass"></i>
            <span>Pesquisar</span>
        </a>
        <a href="/chat">
            <i class="fa-solid fa-comment"></i>
            <span>Chat</span>
        </a>
        <a href="/curtidos">
            <i class="fa-solid fa-heart"></i>
            <span>Favoritos</span>
        </a>
        <a href="/perfil">
            <i class="fa-solid fa-user"></i>
            <span>Perfil</span>
        </a>
    </nav>
</header>

<header th:if="${session.usuarioLogado == null}">
    <div class="logo-header">
        <img src="/img/cinematchlogo1-removebg-preview.png" alt="CineMatch Logo">
        <h1>CineMatch</h1>
    </div>
    <div class="header-actions">
        <a href="/login" class="btn-login">Entrar</a>
        <a href="/registrar" class="btn-cadastrar">Cadastrar</a>
    </div>
</header>

<main>

    <section class="hero" id="inicio" th:if="${session.usuarioLogado == null}">
        <div class="hero-bg"></div>
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <div class="bemvindo">🎥 Bem-vindo ao</div>

            <div class="titulo-hero">CineMatch</div>
            <div class="subtitulo-hero">
                Onde o amor pelo cinema cria conexões reais.<br>
                Descubra quem vibra, se emociona e sonha com as mesmas histórias que você.
            </div>
            <a href="#catalogo" class="btn-hero" id="btnExplorar">
                <i class="fa-solid fa-film" href="/registrar"></i> Explorar Agora
            </a>
        </div>

        <div class="scroll-indicator">
            <div class="bar"></div>
        </div>

        <div class="wave">
            <svg viewBox="0 0 1440 120" preserveAspectRatio="none">
                <path d="M0,32 C220,120 440,0 720,48 C1000,96 1220,16 1440,64 L1440 120 L0 120 Z" fill="#0b0014"></path>
            </svg>
        </div>
    </section>

    <section class="titulo-sessao">
        <div class="titulo-container">
            <h2>🎬 Alguns títulos pra você:</h2>
        </div>
    </section>

    <!-- CATÁLOGO original -->
    <section th:if="${session.usuarioLogado != null}" class="catalogo" id="catalogo">
        <div th:each="filme : ${filmes}" class="card">
            <img th:src="${filme.imagem}" alt="Poster do filme" loading="lazy">
            <h3 th:text="${filme.titulo}">Título</h3>
            <p th:text="${filme.genero}">Gênero</p>
            <div class="botoes">
                <button th:data-id="${filme.imdbId}" th:data-titulo="${filme.titulo}"
                        th:data-imagem="${filme.imagem}" th:data-genero="${filme.genero}"
                        class="btn-favoritar" onclick="favoritarFilme(this)">
                    <i class="fa-solid fa-heart"></i> Favoritar
                </button>

                <button th:data-id="${filme.imdbId}" th:data-titulo="${filme.titulo}"
                        th:data-imagem="${filme.imagem}" th:data-genero="${filme.genero}"
                        class="btn-salvar" onclick="salvarFilme(this)">
                    <i class="fa-solid fa-bookmark"></i> Salvar
                </button>
            </div>
        </div>
    </section>

    <section th:if="${session.usuarioLogado == null}" class="catalogo">
        <div th:each="filme : ${filmes}" class="card">
            <img th:src="${filme.imagem}" alt="Poster do filme" loading="lazy">
            <h3 th:text="${filme.titulo}">Título</h3>
            <p th:text="${filme.genero}">Gênero</p>
        </div>
    </section>
</main>

<footer class="footer">
    <div class="footer-container">
        <div class="footer-col">
            <img th:src="@{/img/cinematchlogo1-removebg-preview.png}" alt="Cinemach" class="footer-logo">
            <p>Soluções de recomendação e descoberta de filmes personalizadas.</p>
        </div>

        <div class="footer-col">
            <h4>Links Rápidos</h4>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/registrar">Pesquisar</a></li>
                <li><a href="/registrar">Chat</a></li>
                <li><a href="/registrar">Favoritos</a></li>
                <li><a href="/registrar">Perfil</a></li>
            </ul>
        </div>

        <div class="footer-col">
            <h4>Contato</h4>
            <p><i class="fa-solid fa-location-dot"></i> Rua Exemplo, 123 - São Paulo, SP</p>
            <p><i class="fa-solid fa-phone"></i> (11) 1234-5678</p>
            <p><i class="fa-solid fa-envelope"></i> contato@cinematch.com.br</p>
        </div>
    </div>

    <div class="footer-bottom">
        <p>© 2025 Cinematch. Todos os direitos reservados.</p>
    </div>
</footer>

<script src="https://kit.fontawesome.com/a2e0e6c6c1.js" crossorigin="anonymous"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {

  // ===== BOTÃO "EXPLORAR AGORA" =====
  const botaoExplorar = document.getElementById("btnExplorar");
  if (botaoExplorar) {
    botaoExplorar.addEventListener("click", function(e) {
      e.preventDefault();

      const secaoCatalogo = document.getElementById("catalogo");
      if (!secaoCatalogo) {
        console.warn("Seção #catalogo não encontrada");
        return;
      }

      const header = document.querySelector("header");
      const headerAltura = header ? header.offsetHeight : 0;

      const destino = secaoCatalogo.getBoundingClientRect().top + window.scrollY - headerAltura - 12;
      window.scrollTo({ top: destino, behavior: "smooth" });
    });
  }

  // ===== FAVORITAR FILME =====
  window.favoritarFilme = async function(botao) {
    const imdbId = botao.getAttribute("data-id");
    const titulo = botao.getAttribute("data-titulo");
    const imagem = botao.getAttribute("data-imagem");
    const genero = botao.getAttribute("data-genero");

    try {
      const resposta = await fetch("/favoritar", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `imdbId=${encodeURIComponent(imdbId)}&titulo=${encodeURIComponent(titulo)}&imagem=${encodeURIComponent(imagem)}&genero=${encodeURIComponent(genero)}`
      });

      const resultado = await resposta.text();

      if (resultado === "ADICIONADO") {
        botao.classList.add("favoritado");
        botao.innerHTML = '<i class="fa-solid fa-heart-circle-check"></i> Favoritado';
      } else if (resultado === "REMOVIDO") {
        botao.classList.remove("favoritado");
        botao.innerHTML = '<i class="fa-solid fa-heart"></i> Favoritar';
      } else if (resultado.startsWith("ERRO")) {
        alert("Você precisa estar logado para favoritar filmes.");
      }
    } catch (erro) {
      console.error("Erro ao favoritar:", erro);
      alert("Ocorreu um erro ao tentar favoritar o filme.");
    }
  };
});

    window.salvarFilme = async function(botao) {
    const imdbId = botao.getAttribute("data-id");
    const titulo = botao.getAttribute("data-titulo");
    const imagem = botao.getAttribute("data-imagem");
    const genero = botao.getAttribute("data-genero");

    try {
        const resposta = await fetch("/perfil/salvarFilme", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: `imdbId=${encodeURIComponent(imdbId)}&titulo=${encodeURIComponent(titulo)}&imagem=${encodeURIComponent(imagem)}&genero=${encodeURIComponent(genero)}`
        });

        const resultado = await resposta.text();

        if (resultado === "ADICIONADO") {
            botao.classList.add("salvo");
            botao.innerHTML = '<i class="fa-solid fa-bookmark-circle-check"></i> Salvo';
        } else if (resultado === "REMOVIDO") {
            botao.classList.remove("salvo");
            botao.innerHTML = '<i class="fa-solid fa-bookmark"></i> Salvar';
        } else if (resultado === "LIMITE") {
            alert("Você já salvou o máximo de 10 filmes!");
        } else if (resultado === "ERRO_LOGIN") {
            alert("Você precisa estar logado para salvar filmes.");
        }
    } catch (erro) {
        console.error("Erro ao salvar filme:", erro);
        alert("Erro ao salvar filme.");
    }
};
</script>
</body>
</html>
